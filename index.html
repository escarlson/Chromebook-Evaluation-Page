<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" type="image/png" href="/CrEval/favicon.png" />
    <link rel="icon" type="image/png" href="/CrEval/favicon.png" />
    <title>CrEval</title>
    <style>
      .key {
        border: 1px solid #000;
        border-radius: 4px;
        margin: 2px;
        padding: 2px;
        display: flex;
      }
      .key * {
        font-size: 12px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .keyboard {
        font-size: 40px;
      }
      h1, h2, h3, h4 {
        text-align: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      p {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      button {
				padding: 10px;
				margin-top: 10px;
			}
      video {
        width: 50%;
      }
			/* body {
				display: flex;
				flex-direction: column;
				align-items: flex-start;
        align-content: center;
			} */
    </style>
    <script src="https://unpkg.com/bowser@2.4.0/es5.js"></script>
  </head>
  <body>
    <div>
      <h2>System Information</h2>
      <div style="text-align: center;">
        <p><script>
      var result = bowser.getParser(window.navigator.userAgent);
        console.log(result);
        document.write("You are using " + result.parsedResult.browser.name +
                       " v" + result.parsedResult.browser.version + 
                       " on " + result.parsedResult.os.name);
        </script></p>
      </div>
    </div>
    <div>
      <h2>Speaker Test</h2>
      <script>
        function playLeftSound(a){
        var sound = new Audio(a);
        sound.play();
        }
        function playRightSound(a){
        var sound = new Audio(a);
        sound.play();
        }
      </script>
      <div id="sound-buttons" style="display:flex; justify-content: center; column-gap: 16px;">
        <button id="play-left" onclick="playLeftSound('audio/semantron-left.ogg')">
          Left Speaker
        </button>
        <button id="play-right" onclick="playRightSound('audio/semantron-right.ogg')">
          Right Speaker
        </button>
      </div>
      <div id="sound-buttons" style="display:flex; justify-content: center; column-gap: 16px;">
        <button id="play-left" onclick="playLeftSound('audio/ede-left.ogg')">
          Left Speaker (Ede)
        </button>
        <button id="play-right" onclick="playRightSound('audio/ede-right.ogg')">
          Right Speaker (Ede)
        </button>
      </div>
    </div>
    <div style="display: flex; flex-direction: column; align-items: center;">
      <h2>Camera & Microphone Test</h2>
      <video controls muted></video>
		  <canvas id="meter" width="500" height="50" style="z-index: 99999;"></canvas>
		  <button>Resume/suspend volume meter</button>
		  <script src="volume-meter.js"></script>
	  	<script src="main.js"></script> 
    </div>
    <div>
      <h2>Keyboard Test</h2>
    </div>
    
    <div style="display: flex; justify-content: center;">
      <div class="keyboard">
        <div style="display: flex;">
          <div class="key" style="width: 1em; height: 1em;" id="escape"><span>Esc</span></div>
          <div style="width: 1em; height: 1em; margin: 5px;"></div>
          <div class="key" style="width: 1em; height: 1em;" id="f1"><span>F1</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f2"><span>F2</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f3"><span>F3</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f4"><span>F4</span></div>
          <div style="width: .5em; height: 1em; margin: 2.5px;"></div>
          <div class="key" style="width: 1em; height: 1em;" id="f5"><span>F5</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f6"><span>F6</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f7"><span>F7</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f8"><span>F8</span></div>
          <div style="width: .5em; height: 1em; margin: 2.5px;"></div>
          <div class="key" style="width: 1em; height: 1em;" id="f9"><span>F9</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f10"><span>F10</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f11"><span>F11</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f12"><span>F12</span></div>
        </div>
        <div style="width: 1em; height: .2em; margin: 5px;"></div>
        <div style="display: flex;">
          <div class="key" style="width: 1em; height: 1em;" id="`"><span>~<br />`</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="1"><span>!<br />1</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="2"><span>@<br />2</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="3"><span>#<br />3</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="4"><span>$<br />4</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="5"><span>%<br />5</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="6"><span>^<br />6</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="7"><span>&<br />7</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="8"><span>*<br />8</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="9"><span>(<br />9</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="0"><span>)<br />0</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="-"><span>_<br />-</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="="><span>+<br />=</span></div>
          <div class="key" style="width: calc(2em + 10px); height: 1em;" id="backspace"><span>Backspace</span></div>
        </div>
        <div style="display: flex; position: relative;">
          <div class="key" style="width: calc(1.5em + 5px); height: 1em;" id="tab"><span>Tab</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="q"><span>Q</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="w"><span>W</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="e"><span>E</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="r"><span>R</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="t"><span>T</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="y"><span>Y</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="u"><span>U</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="i"><span>I</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="o"><span>O</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="p"><span>P</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="["><span>{<br />[</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="]"><span>}<br />]</span></div>
          <div class="key" style="width: calc(1.5em + 5px); height: 1em;" id="\"><span>|<br />\</span></div>
        </div>
        <div style="display: flex;">
          <div class="key" style="width: calc(1.7em + 10px); height: 1em;" id="lmeta"><span>üîç</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="a"><span>A</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="s"><span>S</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="d"><span>D</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="f"><span>F</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="g"><span>G</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="h"><span>H</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="j"><span>J</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="k"><span>K</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="l"><span>L</span></div>
          <div class="key" style="width: 1em; height: 1em;" id=";"><span>:<br />;</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="'"><span>"<br />'</span></div>
          <div class="key" style="width: calc(2.3em + 10px); height: 1em;" id="enter"><span>Enter</span></div>
        </div>
        <div style="display: flex; position: relative;">
          <div class="key" style="width: calc(2.2em + 15px); height: 1em;" id="lshift"><span>Shift</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="z"><span>Z</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="x"><span>X</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="c"><span>C</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="v"><span>V</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="b"><span>B</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="n"><span>N</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="m"><span>M</span></div>
          <div class="key" style="width: 1em; height: 1em;" id=","><span><br />,</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="."><span>><br />.</span></div>
          <div class="key" style="width: 1em; height: 1em;" id="/"><span>?<br />/</span></div>
          <div class="key" style="width: calc(2.8em + 15px); height: 1em;" id="rshift"><span>Shift</span></div>
          <div style="width: .2em; height: 1em; margin: 1px;"></div>
          <div style="width: 1em; height: 1em; margin: 5px;"></div>
        </div>
        <div style="display: flex;">
          <div class="key" style="width: calc(2.2em + 10px); height: 1em;" id="lcontrol"><span>Control</span></div>
          <div class="key" style="width: calc(2.2em + 7px); height: 1em;" id="lalt"><span>Alt</span></div>
          <div class="key" style="width: calc(5.3em + 10px); height: 1em;" id=" "><span>Space</span></div>
          <div class="key" style="width: calc(1.2em + 8px); height: 1em;" id="ralt"><span>Alt</span></div>
          <div class="key" style="width: calc(1.2em + 5px); height: 1em;" id="rcontrol"><span>Control</span></div>
          <div style="width: .2em; height: 1em; margin: 1px;"></div>
          <div class="key" style="width: 1em; height: 1em;" id="arrowleft"><span>‚≠†</span></div>
          <div style="display: flex; flex-direction: column; height: .75em;">
            <div class="key" style="width: 1em; height: .375em;" id="arrowup"><span>‚≠°</span></div>
            <div class="key" style="width: 1em; height: .375em;" id="arrowdown"><span>‚≠£</span></div>
          </div>
          <div class="key" style="width: 1em; height: 1em;" id="arrowright"><span>‚≠¢</span></div>
        </div>
      </div>
    </div>

    <script>
    const numMap = {
      home: 'num7',
      end: 'num1',
      pageup: 'num9',
      pagedown: 'num3',
      arrowup: 'num8',
      arrowdown: 'num2',
      arrowleft: 'num4',
      arrowright: 'num6',
      clear: 'num5',
      insert: 'num0',
      delete: 'num.',
    };
    const keyBg = '#227ae5';
    const lrMap = ['l', 'r'];
    window.addEventListener('keydown', onKeyDownHandle);
    window.addEventListener('keyup', onKeyUpHandle);
    function onKeyDownHandle(e) {
      e.preventDefault();
      console.log(e.key);
      const keyName = e.key.toLowerCase();
      if (['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '.', '/', '-', 'enter'].indexOf(keyName) !== -1) {
        if (e.location === 3) {
          const key = document.getElementById("num" + keyName);
          key.style.background = keyBg;
          return;
        }
      }
      if (['BrowserForward', 'home', 'end', 'pageup', 'pagedown', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright', 'clear', 'insert', 'delete'].indexOf(keyName) !== -1) {
        if (e.location === 3) {
          const key = document.getElementById(numMap[keyName]);
          key.style.background = keyBg;
          return;
        }
      }
      if (['shift', 'control', 'alt', 'meta'].indexOf(keyName) !== -1) {
        const key = document.getElementById(lrMap[e.location - 1] + keyName);
        key.style.background = keyBg;
        return;
      }
      const key = document.getElementById(keyName);
      key.style.background = keyBg;
    }
    function onKeyUpHandle(e) {
      e.preventDefault();
      console.log(e.key);
      const keyName = e.key.toLowerCase();
      if (['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '.', '/', '-', 'enter'].indexOf(keyName) !== -1) {
        if (e.location === 3) {
          const key = document.getElementById("num" + keyName);
          // key.style.background = 'initial';
          return;
        }
      }
      if (['home', 'end', 'pageup', 'pagedown', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright', 'clear', 'insert', 'delete'].indexOf(keyName) !== -1) {
        if (e.location === 3) {
          const key = document.getElementById(numMap[keyName]);
          // key.style.background = 'initial';
          return;
        }
      }
      if (['shift', 'control', 'alt', 'meta'].indexOf(keyName) !== -1) {
        const key = document.getElementById(lrMap[e.location - 1] + keyName);
        // key.style.background = 'initial';
        return;
      }
      if (keyName === 'printscreen') {
        const key = document.getElementById(keyName);
        key.style.background = keyBg;
        const timer = setTimeout(function() {
          // key.style.background = 'initial';
          clearTimeout(timer);
        }, 100);
        return;
      }
      const key = document.getElementById(keyName);
      // key.style.background = 'initial';
    }
    </script>
    <div style="text-align: center;">
      <h2>Attribution</h2>
      <p>Camera & Microphone Test based on <a href="https://github.com/escarlson/VideoStreamVolumeMeterSample">VideoStreamVolumeMeterSample</a> by Steven Carlson, itself based on <a href="https://github.com/SergeyZaligin/VideoStreamVolumeMeterSample">a work</a> by Sergey Zaligin</a></p>
      <p>Keyboard Test based on <a href="https://github.com/Tarocch1/keyboard-tester">Keyboard Tester by Tarocch1</a> released under the MIT License</p>
      <p>Favicon by <a href="https://commons.wikimedia.org/wiki/File:Electron_shell_024_Chromium_-_no_label.svg">Pumbaa (original work by Greg Robson)</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/uk/deed.en">CC BY-SA 2.0 UK</a>, via Wikimedia Commons</div><p>
  </div>
  </body>
</html>
